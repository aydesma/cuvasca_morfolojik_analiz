<!DOCTYPE html>
<html lang="tr" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Çuvaşça Morfolojik Analiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        darkbg: '#09090b',
                        darkcard: '#18181b',
                        primary: '#dc2626', // Kırmızı (Red) - Çuvaş Bayrağı Rengi
                        darkprimary: '#ef4444',
                        accent: '#fca5a5',      // Açık Kırmızı
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            transition: background-color 0.3s, color 0.3s;
        }

        .code-normal {
            font-weight: 700;
            font-size: 1.25rem;
        }

        /* Dark Mode İnce Ayarlar */
        .dark .code-badge {
            color: #fca5a5;
        }

        .dark .result-box {
            background-color: #27272a;
            border-color: #3f3f46;
            color: #e4e4e7;
        }

        .dark .input-field {
            background-color: #27272a;
            border-color: #3f3f46;
            color: white;
        }

        .kb-key {
            transition: all 0.1s;
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.1);
        }

        .kb-key:active {
            transform: translateY(2px);
            box-shadow: none;
        }
    </style>
</head>

<body
    class="bg-gray-50 text-gray-800 dark:bg-darkbg dark:text-gray-200 flex flex-col items-center min-h-screen py-8 px-4">

    <div class="w-full max-w-3xl flex justify-between items-center mb-6">
        <div class="flex items-center gap-2">
            <div class="h-8 w-1 bg-red-600 dark:bg-darkprimary rounded-full"></div>
            <h1 class="text-2xl font-bold tracking-tight">Çuvaşça Morfolojik Analiz</h1>
        </div>
        <button id="theme-toggle"
            class="p-2 rounded-full bg-gray-200 dark:bg-zinc-800 text-gray-600 dark:text-yellow-400 hover:ring-2 ring-red-400 dark:ring-red-400 transition focus:outline-none">
            <svg id="sun-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                </path>
            </svg>
            <svg id="moon-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
        </button>
    </div>

    <div
        class="bg-white dark:bg-darkcard rounded-2xl shadow-xl w-full max-w-3xl p-6 md:p-8 mb-8 border border-gray-100 dark:border-zinc-800 transition-colors">

        <!-- Analiz Formu -->
        <form method="POST" id="form-analiz" class="space-y-6">

            <div>
                <div class="flex justify-between items-end mb-2">
                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">Kök Kelime</label>
                    <button type="button" onclick="fillRandom()"
                        class="text-xs text-red-600 dark:text-accent hover:underline font-medium flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                            </path>
                        </svg>
                        Örnek Getir
                    </button>
                </div>
                <input type="text" id="rootInput" name="root" required placeholder="örn: анне"
                    value="{{ root if root else '' }}"
                    class="input-field w-full p-2.5 border border-gray-200 rounded-lg bg-gray-50 focus:bg-white dark:focus:bg-zinc-900 focus:ring-2 focus:ring-red-500 dark:focus:ring-red-500 focus:outline-none transition text-base">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Şahıs</label>
                    <div class="relative">
                        <select name="sahis"
                            class="input-field w-full p-2.5 border border-gray-200 rounded-lg bg-white cursor-pointer focus:ring-2 focus:ring-red-500 dark:focus:ring-red-500 outline-none appearance-none font-medium text-base h-11">
                            <option value="1sg" {% if not selected_sahis or selected_sahis=='1sg' %}selected{% endif %}>
                                1. Tekil şahıs (ben)</option>
                            <option value="2sg" {% if selected_sahis=='2sg' %}selected{% endif %}>2. Tekil şahıs (sen)</option>
                            <option value="3sg" {% if selected_sahis=='3sg' %}selected{% endif %}>3. Tekil şahıs (o)</option>
                            <option value="1pl" {% if selected_sahis=='1pl' %}selected{% endif %}>1. Çoğul şahıs (biz)</option>
                            <option value="2pl" {% if selected_sahis=='2pl' %}selected{% endif %}>2. Çoğul şahıs (siz)</option>
                            <option value="3pl" {% if selected_sahis=='3pl' %}selected{% endif %}>3. Çoğul şahıs (onlar)</option>
                        </select>
                        <div
                            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Sayı</label>
                    <input type="hidden" id="pluralInput" name="plural" value="{{ 'on' if selected_plural else '' }}">
                    <button type="button" id="pluralBtn" onclick="togglePlural()"
                        class="w-full p-2.5 h-11 rounded-lg border transition-all duration-200 flex items-center justify-between group {{ 'bg-red-50 border-red-200 text-red-700 dark:bg-red-900/20 dark:border-red-800 dark:text-red-300' if selected_plural else 'bg-white border-gray-200 text-gray-500 hover:border-red-300 hover:text-red-600 dark:bg-darkcard dark:border-zinc-700 dark:text-gray-400' }}">
                        <span class="font-medium text-base">Çoğul</span>
                        <div
                            class="w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors {{ 'border-red-500 bg-red-500 text-white' if selected_plural else 'border-gray-300 group-hover:border-red-400' }}">
                            <svg class="w-3 h-3 {{ '' if selected_plural else 'hidden' }}" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                    </button>
                </div>
            </div>

            <button type="submit"
                class="w-full bg-red-600 hover:bg-red-700 dark:bg-red-600 dark:hover:bg-red-500 text-white font-bold py-4 rounded-xl transition duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                Analiz Et
            </button>
        </form>

        {% if result %}
        <div class="mt-10 border-t border-gray-100 dark:border-zinc-800 pt-8 animate-fade-in">
            <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-6 text-center">
                Analiz Sonucu
            </h2>

            <div class="flex flex-wrap justify-center items-center gap-3 mb-8">
                {% for part in result %}
                <div class="flex flex-col items-center group">
                    <div class="mb-1">
                        <span class="code-normal text-red-600 dark:text-accent text-base">
                            {% if part.code == '1sg' %}
                                1.T.Ş
                            {% elif part.code == '2sg' %}
                                2.T.Ş
                            {% elif part.code == '3sg' %}
                                3.T.Ş
                            {% elif part.code == '1pl' %}
                                1.Ç.Ş
                            {% elif part.code == '2pl' %}
                                2.Ç.Ş
                            {% elif part.code == '3pl' %}
                                3.Ç.Ş
                            {% elif part.code == 'PL' %}
                                Çoğul
                            {% else %}
                                {{ part.code }}
                            {% endif %}
                        </span>
                    </div>
                    <div
                        class="result-box bg-gray-50 border border-gray-200 text-gray-800 px-5 py-2 rounded-lg font-mono text-lg shadow-sm transition">
                        {{ part.text }}
                    </div>
                </div>
                {% if not loop.last %}
                <span class="text-gray-300 dark:text-gray-600 text-2xl font-light mt-6">+</span>
                {% endif %}
                {% endfor %}
            </div>

            <div
                class="relative flex flex-col justify-center items-center bg-green-50 dark:bg-zinc-900 rounded-xl p-6 border border-green-200 dark:border-green-900 transition-colors">
                <p class="text-base font-bold text-green-600 dark:text-green-400 mb-2 uppercase tracking-wider">
                    Oluşturulan Kelime</p>
                <div class="w-full text-center">
                    <p id="finalWord"
                        class="text-2xl md:text-4xl font-bold text-gray-900 dark:text-white tracking-tight">{{
                        final_word }}</p>
                </div>
                <button onclick="copyResult()"
                    class="absolute right-4 md:right-6 p-2 text-gray-400 hover:text-green-600 dark:hover:text-green-400 transition rounded-full hover:bg-green-100 dark:hover:bg-zinc-800"
                    title="Kopyala">
                    <svg id="copyIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                        </path>
                    </svg>
                    <svg id="checkIcon" class="w-6 h-6 text-green-500 hidden" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </button>
            </div>
        </div>
        {% endif %}
    </div>

    <div class="w-full max-w-3xl" id="history-container" style="display:none;">
        <div class="flex items-center justify-between mb-4 px-2">
            <h3 class="text-lg font-bold text-gray-700 dark:text-gray-300">Geçmiş Aramalar</h3>
            <button onclick="clearHistory()" class="text-xs text-red-500 hover:text-red-700 underline">Geçmişi
                Temizle</button>
        </div>
        <div class="grid gap-3" id="history-list">
        </div>
    </div>

    <div class="mt-12 text-gray-400 dark:text-gray-600 text-sm font-medium">
        &copy; 2025 Çuvaşça Morfolojik Analiz Projesi - Esma Aydın
    </div>

    <script>
        const themeToggle = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        const htmlElement = document.documentElement;

        // Tema Yönetimi
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            htmlElement.classList.add('dark');
            sunIcon.classList.remove('hidden');
            moonIcon.classList.add('hidden');
        } else {
            htmlElement.classList.remove('dark');
            sunIcon.classList.add('hidden');
            moonIcon.classList.remove('hidden');
        }

        themeToggle.addEventListener('click', () => {
            htmlElement.classList.toggle('dark');
            if (htmlElement.classList.contains('dark')) {
                localStorage.setItem('theme', 'dark');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                localStorage.setItem('theme', 'light');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        });

        function addChar(char) {
            const input = document.getElementById('rootInput');
            if (input.value.length === 0) {
                input.value += char.toUpperCase();
            } else {
                input.value += char;
            }
            input.focus();
        }

        function togglePlural() {
            const input = document.getElementById('pluralInput');
            const btn = document.getElementById('pluralBtn');
            const icon = btn.querySelector('svg');
            const circle = btn.querySelector('div');

            if (input.value === 'on') {
                // Turn off
                input.value = '';
                btn.className = "w-full p-2.5 h-11 rounded-lg border transition-all duration-200 flex items-center justify-between group bg-white border-gray-200 text-gray-500 hover:border-red-300 hover:text-red-600 dark:bg-darkcard dark:border-zinc-700 dark:text-gray-400";
                circle.className = "w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors border-gray-300 group-hover:border-red-400";
                icon.classList.add('hidden');
            } else {
                // Turn on
                input.value = 'on';
                btn.className = "w-full p-2.5 h-11 rounded-lg border transition-all duration-200 flex items-center justify-between group bg-red-50 border-red-200 text-red-700 dark:bg-red-900/20 dark:border-red-800 dark:text-red-300";
                circle.className = "w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors border-red-500 bg-red-500 text-white";
                icon.classList.remove('hidden');
            }
        }

        function fillRandom() {
            const words = [
                "анне", "атте", "кукамай", "кукаçи", "шӑллӑм", "пичче", "аппа", "йӑмӑк",
                "куç", "пуç", "алӑ", "ура", "пӳрне", "шӑл", "хӑлха", "чӗре",
                "кил", "алӑк", "чӳрече", "сӗтел", "пӳлӗм", "сад", "телефон", "компьютер",
                "шыв", "ту", "юханшыв", "тинӗс", "йывӑç", "чечек", "çулçӑ", "пӗлӗт", "çумӑр",
                "лаша", "йытӑ", "кушак", "кайӑк", "сурӑх", "ӗне",
                "тӑван", "ял", "хула", "çул", "кун", "уйӑх", "вӑхӑт",
                "кӗнеке", "тетрадь", "карандаш", "ручка", "парта", "шкул", "класс",
                "учитель", "вӗренекен", "студент", "университет", "библиотека",
                "магазин", "пазар", "çӑкӑр", "сӗт", "çу", "аш", "пулӑ", "çимӗç",
                "улма", "çырла", "хӗвел", "çӑлтӑр", "çер", "уй", "вӑрман"
            ];
            const randomWord = words[Math.floor(Math.random() * words.length)];
            document.getElementById('rootInput').value = randomWord;
        }

        function copyResult() {
            const text = document.getElementById('finalWord').innerText;
            navigator.clipboard.writeText(text).then(() => {
                document.getElementById('copyIcon').classList.add('hidden');
                document.getElementById('checkIcon').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('copyIcon').classList.remove('hidden');
                    document.getElementById('checkIcon').classList.add('hidden');
                }, 2000);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            {% if result %}
            const newEntry = {
                root: "{{ root }}",
                word: "{{ final_word }}",
                parts: [
                    {% for part in result %}
            { text: "{{ part.text }}", code: "{{ part.code }}", type: "{{ part.type }}" },
            {% endfor %}
                    ]
        };
        saveToHistory(newEntry);
        {% endif %}
        renderHistory();
        });

        function saveToHistory(entry) {
            let history = JSON.parse(localStorage.getItem('chuvashHistory')) || [];
            history.unshift(entry);
            if (history.length > 20) history.pop();
            localStorage.setItem('chuvashHistory', JSON.stringify(history));
        }

        function renderHistory() {
            const codeMap = {
                '1sg': '1.T.Ş',
                '2sg': '2.T.Ş',
                '3sg': '3.T.Ş',
                '1pl': '1.Ç.Ş',
                '2pl': '2.Ç.Ş',
                '3pl': '3.Ç.Ş',
                'PL': 'Çoğul'
            };
            let history = JSON.parse(localStorage.getItem('chuvashHistory')) || [];
            const container = document.getElementById('history-container');
            const list = document.getElementById('history-list');

            if (history.length === 0) {
                container.style.display = 'none';
                return;
            }
            container.style.display = 'block';
            list.innerHTML = '';

            history.forEach(item => {
                let partsHtml = '';
                item.parts.forEach(part => {
                    if (part.code !== 'Kök') {
                        // codeMap içinde varsa onu yaz, yoksa orijinal kodu (part.code) yaz
                        let displayCode = codeMap[part.code] || part.code; 
                        
                        partsHtml += `
                        <span class="bg-red-50 dark:bg-zinc-700 text-red-600 dark:text-accent px-2 py-1 rounded border border-red-100 dark:border-zinc-600 font-semibold ml-1 text-xs">
                            ${displayCode}
                        </span>`;
                    }
                });

                const html = `
                <div class="bg-white dark:bg-darkcard p-4 rounded-xl shadow-sm border border-gray-100 dark:border-zinc-800 hover:shadow-md transition flex justify-between items-center">
                    <div>
                        <span class="text-xs text-gray-400 font-mono block mb-1">Kök: ${item.root}</span>
                        <span class="text-lg font-bold text-gray-800 dark:text-gray-200">${item.word}</span>
                    </div>
                    <div class="flex gap-1 text-xs">
                        ${partsHtml}
                    </div>
                </div>`;
                list.innerHTML += html;
            });
        }

        function clearHistory() {
            localStorage.removeItem('chuvashHistory');
            renderHistory();
        }
    </script>

</body>

</html>
